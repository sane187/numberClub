<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Signup</title>
    <link rel="stylesheet" href="./Css/sign.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
  </head>
  <body>
    <div class="d-none d-lg-block">
      <div class="wrapper p-5">
        <div class="sign-container mx-3 mt-2">
          <div class="container-fluid p-3">
            <div class="row align-items-center">
              <div class="col-xl-6 col-lg-6">
                <div class="image-column">
                  <img src="./Assets/sign.svg" />
                </div>
              </div>
              <div class="col-xl-6 col-lg-6">
                <div class="sign-section p-4">
                  <div class="welcome-message mt-5 mb-5">
                    <h2 class="text-center">Hello ! Welcome back.</h2>
                    <p>
                      There is no need to remember a password, All you need is
                      your Mobile number
                    </p>
                  </div>
                  <form class="sign-form">
                    <div class="mb-2">
                      <label for="Email" class="form-label"
                        >Login / Sign Up</label
                      >
                      <input
                        type="text"
                        class="form-control sign-input-lg"
                        placeholder="Enter number here..."
                      />
                    </div>
                    <button type="button" class="btn btn-primary continue">
                      Continue
                    </button>
                  </form>
                  <div class="mt-3 option-div-cont">
                    <div class="option-div otp">Login with OTP</div>
                    <div class="option-div login-btn ms-3">
                      Login with Password
                    </div>
                  </div>

                  <h3 class="mb-3">
                    Don't have account ? <a href="./Register.html">Sign Up</a>
                  </h3>

                  <div class="otpScreen p-3 d-none">
                    <i
                      class="fa-solid fa-xmark d-flex justify-content-end close-lg"
                      style="color: #f44b01; cursor: pointer"
                    ></i>
                    <h2 class="otp-title">Verify Details</h2>
                    <h3>OTP sent to your mobile number.</h3>
                    <div class="d-flex align-items-center flex-row">
                      <h5 class="registered-Number mb-1">+91-9530000007</h5>
                    </div>
                    <div class="d-flex flex-row mb-2">
                      <input
                        type="text"
                        minlength="1"
                        id="otp1"
                        placeholder="Enter OTP here..."
                        style="border-radius: 4px"
                      />
                    </div>
                    <button
                      class="resend-link p-1 mb-0"
                      style="border: 1.5px solid #f44b01; border-radius: 6px"
                    >
                      Login
                    </button>
                  </div>

                  <div class="login-screen-lg d-none">
                    <p class="mb-1">NUMBER: <span class="ms-3"></span></p>
                    <div class="mb-3 d-flex align-items-center">
                      <label for="password-inp" class="form-label me-2 mb-0"
                        >PASSWORD</label
                      >
                      <input
                        type="text"
                        id="password-inp"
                        class="form-control"
                        placeholder="Enter password here..."
                        style="width: 40%"
                      />
                    </div>
                    <button type="btn" class="btn-secondary btn login-call">
                      Login
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="d-block d-lg-none">
      <div class="wrapper p-1">
        <div class="sign-container mx-3" style="margin-top: 25%">
          <div class="sign-section p-4">
            <div class="welcome-message mt-5 mb-5">
              <h2 class="text-center">Hello ! Welcome back.</h2>
              <p>
                There is no need to remember a password, All you need is your
                email address
              </p>
            </div>
            <form class="sign-form-mobile">
              <div class="mb-3">
                <label for="Email" class="form-label">Login / Sign Up</label>
                <input
                  type="email"
                  class="form-control sign-input-sm"
                  placeholder="Enter number here..."
                />
              </div>
              <button class="continue-sm btn btn-primary" type="button">
                Continue
              </button>
              <div
                class="mt-3 option-div-cont-sm justify-content-center"
                style="display: none"
              >
                <div class="option-div otp">Login with OTP</div>
                <div class="option-div login-btn ms-3">Login with Password</div>
              </div>
              <h3>
                Don't have account ? <a href="./Register.html">Sign Up</a>
              </h3>
            </form>
            <div class="otpScreen-Mobile p-3 d-none">
              <i
                class="fa-solid fa-xmark close d-flex justify-content-end"
                style="color: #f44b01; cursor: pointer"
              ></i>
              <h2 class="otp-title">Verify Details</h2>
              <h3>OTP sent to your mobile number.</h3>
              <div class="d-flex align-items-center flex-row">
                <h3 class="registered-Number-mobile" contenteditable="true">
                  +91-9530000007
                </h3>
                <a
                  href="#"
                  style="margin-top: 12px; margin-left: 10px"
                  class="Edit-mobile"
                  >Edit</a
                >
              </div>

              <div class="d-flex flex-row">
                <input type="text" minlength="1" id="val1" />
              </div>
              <a href="#" class="resend-link">Resend OTP</a>
              <h2 class="message">
                - Make sure you entered correct mobile number
              </h2>
              <h2 class="message">
                -You can also
                <span><a href="#">Login with Password</a></span>
              </h2>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      let loginCall = document.querySelector(".login-call");
      let cont = document.querySelector(".option-div-cont");
      let btn = document.querySelector(".otp");
      let form = document.querySelector(".sign-form");
      let loginS = document.querySelector(".login-screen-lg");
      let loginOTP = document.querySelector(".resend-link");
      let otpScreen = document.querySelector(".otpScreen");
      let closeModal = document.querySelector(".close-lg");
      let edit = document.querySelector(".EditNumber");
      let RegisterNumber = document.querySelector(".registered-Number");
      let otp1 = document.getElementById("otp1");

      otp1.addEventListener("input", getOtp);
      let OTP;
      let value = true;
      form.addEventListener("click", function (e) {
        e.preventDefault();
      });
      btn.addEventListener("click", showOtpScreen);

      closeModal.addEventListener("click", showForm);

      import config from "./conf/index.js";

      async function sendOTP(num) {
        try {
          const response = await fetch(
            config.backendEndpoint + `/send_otp?customer=${num}`,
            {
              method: "POST",
              mode: "cors",
              cache: "no-cache",
              credentials: "same-origin",
              redirect: "follow",
              referrerPolicy: "no-referrer",
            }
          );
          return response.json();
        } catch (err) {
          console.error(err);
        }
      }

      async function showOtpScreen() {
        const num = document.querySelector(".sign-input-lg").value;
        btn.innerText = "Resend OTP";
        let aj = loginS.classList.value.search("d-none");
        if (aj === -1) {
          loginS.classList.add("d-none");
        }

        const res = await sendOTP(num);
        RegisterNumber.innerText = num;
        if (res.status === "success" && num.length > 0) {
          Toastify({
            text: "OTP SENT ",
            duration: 3000,
            newWindow: true,
            close: true,
            gravity: "top", // `top` or `bottom`
            position: "right", // `left`, `center` or `right`
            stopOnFocus: true, // Prevents dismissing of toast on hover
            style: {
              background: "#32cd32",
            },
          }).showToast();

          form.classList.add("hide");
          if (otpScreen.classList.contains("d-none")) {
            otpScreen.classList.remove("d-none");
          }
        } else {
          Toastify({
            text: "Invalid Number",
            duration: 3000,
            newWindow: true,
            close: true,
            gravity: "top", // `top` or `bottom`
            position: "right", // `left`, `center` or `right`
            stopOnFocus: true, // Prevents dismissing of toast on hover
            style: {
              background: "red",
            },
          }).showToast();
        }
      }

      function showForm() {
        otpScreen.classList.add("d-none");
        form.classList.remove("hide");
        btn.innerText = "Login with OTP";
      }

      function getOtp() {
        OTP = parseInt(otp1.value + otp2.value + otp3.value + otp4.value);
        console.log(OTP);
      }

      const continueLg = document.querySelector(".continue");

      continueLg.addEventListener("click", function () {
        let num = document.querySelector(".sign-input-lg").value.length;
        if (num < 10) {
          Toastify({
            text: "Invalid Number",
            duration: 3000,
            newWindow: true,
            close: true,
            gravity: "top", // `top` or `bottom`
            position: "right", // `left`, `center` or `right`
            stopOnFocus: true, // Prevents dismissing of toast on hover
            style: {
              background: "red",
            },
          }).showToast();
        } else {
          continueLg.style.display = "none";
          cont.classList.add("d-flex");
        }
      });

      document
        .querySelector(".login-btn")
        .addEventListener("click", function () {
          const num = document.querySelector(".sign-input-lg").value;
          document.querySelector(".login-screen-lg span").innerText = num;
          form.classList.add("hide");
          loginS.classList.remove("d-none");
          btn.innerText = "Login with OTP";
          let aj = otpScreen.classList.value.search("d-none");
          if (aj === -1) {
            otpScreen.classList.add("d-none");
          }
        });

      async function customerLogin(num, password) {
        try {
          const response = await fetch(
            config.backendEndpoint + `/customer_login`,
            {
              method: "POST",
              body: JSON.stringify({
                customer_no: `${num}`,
                password: `${password}`,
              }),
              headers: {
                "Content-type": "application/json; charset=UTF-8",
              },
            }
          );
          return response.json();
        } catch (err) {
          console.error(err);
          console.log("aj");
        }
      }
      loginCall.addEventListener("click", async function () {
        let password = document.querySelector("#password-inp").value;
        console.log(password);
        let num = document.querySelector(".sign-input-lg").value;
        try {
          let data = await customerLogin(num, password);

          if (data.status === "success") {
            const user = await fetch(
              config.backendEndpoint + `/customer_info`,
              {
                method: "POST",
                headers: {
                  "Content-type": "application/json; charset=UTF-8",
                  token: `${data.token}`,
                },
              }
            );
            let userData = await user.json();

            if (userData.status === "success") {
              localStorage.setItem("user", JSON.stringify(userData.data));
              Toastify({
                text: "Logged In Successfully",
                duration: 2500,
                newWindow: true,
                close: true,
                gravity: "top", // `top` or `bottom`
                position: "right", // `left`, `center` or `right`
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                  background: "#32cd32",
                },
              }).showToast();
              setTimeout(function () {
                window.location.href = "/index3.html";
              }, 3000);
            }
          } else {
            Toastify({
              text: "Unable to login",
              duration: 2500,
              newWindow: true,
              close: true,
              gravity: "top", // `top` or `bottom`
              position: "right", // `left`, `center` or `right`
              stopOnFocus: true, // Prevents dismissing of toast on hover
              style: {
                background: "red",
              },
            }).showToast();
          }
        } catch (err) {
          console.log(err);
        }
      });

      async function otpLogin(num, otp) {
        try {
          const response = await fetch(
            config.backendEndpoint + `/customer_login`,
            {
              method: "POST",
              body: JSON.stringify({
                customer_no: `${num}`,
                OTP: `${otp}`,
              }),
              headers: {
                "Content-type": "application/json; charset=UTF-8",
              },
            }
          );
          return response.json();
        } catch (err) {
          console.error(err);
        }
      }

      loginOTP.addEventListener("click", async function () {
        let otp = document.querySelector("#otp1").value;
        let num = document.querySelector(".sign-input-lg").value;
        try {
          let data = await otpLogin(num, otp);
          if (data.status === "success") {
            const user = await fetch(
              config.backendEndpoint + `/customer_info`,
              {
                method: "POST",
                headers: {
                  "Content-type": "application/json; charset=UTF-8",
                  token: `${data.token}`,
                },
              }
            );
            let userData = await user.json();

            if (userData.status === "success") {
              localStorage.setItem("user", JSON.stringify(userData.data));
              Toastify({
                text: "Logged In Successfully",
                duration: 2500,
                newWindow: true,
                close: true,
                gravity: "top", // `top` or `bottom`
                position: "right", // `left`, `center` or `right`
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                  background: "#32cd32",
                },
              }).showToast();
              setTimeout(function () {
                window.location.href = "/index3.html";
              }, 3000);
            }
          } else {
            Toastify({
              text: "Unable to login",
              duration: 2500,
              newWindow: true,
              close: true,
              gravity: "top", // `top` or `bottom`
              position: "right", // `left`, `center` or `right`
              stopOnFocus: true, // Prevents dismissing of toast on hover
              style: {
                background: "red",
              },
            }).showToast();
          }
        } catch (err) {
          console.log(err);
        }
      });
    </script>

    <script type="module">
      let continueSm = document.querySelector(".continue-sm");
      let MobileForm = document.querySelector(".sign-form-mobile");
      let OtpScreenMobile = document.querySelector(".otpScreen-Mobile");
      let closeMobileModal = document.querySelector(".close");
      let editMobile = document.querySelector(".Edit-mobile");
      let contSm = document.querySelector(".option-div-cont-sm");

      continueSm.addEventListener("click", function () {
        let num = document.querySelector(".sign-input-sm").value.length;
        if (num < 10) {
          Toastify({
            text: "Invalid Number",
            duration: 3000,
            newWindow: true,
            close: true,
            gravity: "top", // `top` or `bottom`
            position: "right", // `left`, `center` or `right`
            stopOnFocus: true, // Prevents dismissing of toast on hover
            style: {
              background: "red",
            },
          }).showToast();
        } else {
          continueSm.style.display = "none";
          contSm.classList.add("d-flex");
        }
      });

      let RegisterNumberMobile = document.querySelector(
        ".registered-Number-mobile"
      );
      let val1 = document.getElementById("val1");

      let otp;
      let val = true;
      val1.addEventListener("input", getValue);

      OtpMobileBtn.addEventListener("click", ShowOtpMobileScreen);
      closeMobileModal.addEventListener("click", closeOtpMobileScreen);

      editMobile.addEventListener("click", updateNum);
      function ShowOtpMobileScreen() {
        MobileForm.classList.add("hide");
        if (OtpScreenMobile.classList.contains("d-none")) {
          OtpScreenMobile.classList.remove("d-none");
        }
      }
      function closeOtpMobileScreen() {
        OtpScreenMobile.classList.add("d-none");
        MobileForm.classList.remove("hide");
      }
      function getValue() {
        otp = parseInt(val1.value + val2.value + val3.value + val4.value);
        console.log(otp);
      }
      function updateNum() {
        val = !val;
        if (val === false) {
          RegisterNumberMobile.setAttribute("contenteditable", "true");
          editMobile.textContent = "save";
        } else {
          editMobile.textContent = "edit";
          RegisterNumberMobile.removeAttribute("contenteditable");
        }
      }
    </script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>
    <!--script for mobile end--->
  </body>
</html>
