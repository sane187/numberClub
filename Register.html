<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="./Css/index3.css" />

    <link rel="stylesheet" href="./CSS/Register.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v6.1.1/css/all.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>
  <body>
    <div class="d-none d-lg-block">
      <div class="RegisterBg">
        <div class="Register p-3">
          <h1 class="register-title">Registration form</h1>
          <form class="row g-3 register-lg-form">
            <div class="col-md-6">
              <label for="Name" class="form-label">Name</label>
              <input
                type="text"
                class="form-control"
                placeholder="Enter your name"
                id="customer_name"
              />
            </div>
            <div class="col-md-6">
              <label for="MobileNo" class="form-label">Mobile no</label>
              <input
                type="number"
                class="form-control"
                id="customer_no"
                placeholder="Enter your mobile no"
              />
            </div>
            <div class="col-12">
              <label for="state" class="form-label">Email id</label>
              <input
                type="email"
                class="form-control"
                placeholder="Enter your email"
              />
            </div>
            <div class="col-md-6">
              <label for="Passowrd" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="password"
                placeholder="Enter your Passowrd"
              />
            </div>
            <div class="col-md-6">
              <label for="Pincode" class="form-label">Pin Code</label>
              <input
                type="number"
                class="form-control pin"
                placeholder="Enter your post code"
                id="pincode"
                oninput="Pin(this)"
              />
            </div>
            <div class="col-md-6">
              <label for="city" class="form-label">City</label>
              <input
                type="text"
                class="form-control city"
                placeholder="Enter your city"
                id="city"
              />
            </div>
            <div class="col-md-6">
              <label for="state" class="form-label">State</label>
              <input
                type="text"
                class="form-control state"
                placeholder="Enter your state"
                id="state"
              />
            </div>
            <div class="col-12">
              <label for="inputAddress" class="form-label">Address</label>
              <input
                type="text"
                class="form-control"
                placeholder="enter your address"
                id="address"
              />
            </div>
            <button
              type="button"
              id="submit"
              style="width: 20%"
              class="btn btn-primary"
            >
              Create Account
            </button>
          </form>
        </div>
      </div>
      <div id="foot-placeholder"></div>
      <script>
        $(document).ready(function () {
          $("#foot-placeholder").load("./Template/Footer.html");
        });
      </script>
    </div>
    <!--Mobile screen-->
    <div class="d-block d-lg-none">
      <div class="RegisterBg px-2">
        <div class="Register p-3">
          <h1 class="register-title">Resgistration form</h1>
          <form class="row g-3 register-form-sm">
            <div class="col-md-6">
              <label for="Name" class="form-label">Name</label>
              <input
                type="text"
                class="form-control"
                placeholder="Enter your name"
                name="customer_name"
              />
            </div>
            <div class="col-md-6">
              <label for="MobileNo" class="form-label">Mobile no</label>
              <input
                type="number"
                class="form-control"
                placeholder="Enter your mobile no"
                name="customer_no"
              />
            </div>
            <div class="col-md-6">
              <label for="MobileNo" class="form-label">Email Id</label>
              <input
                type="email"
                class="form-control"
                placeholder="Enter your email"
                name="email"
              />
            </div>
            <div class="col-md-6">
              <label for="Passowrd" class="form-label">Passowrd</label>
              <input
                type="password"
                class="form-control"
                placeholder="Enter your passowrd"
                name="password"
              />
            </div>
            <div class="col-md-6">
              <label for="PinCode" class="form-label">Pin code</label>
              <input
                type="number"
                class="form-control pin-m"
                placeholder="Enter your post code"
                oninput="PinMobile(this)"
                name="pincode"
              />
            </div>
            <div class="col-md-6">
              <label for="city" class="form-label">city</label>
              <input
                type="text"
                class="form-control city-m"
                placeholder="Enter your city"
                name="city"
              />
            </div>
            <div class="col-md-6">
              <label for="state" class="form-label">State</label>
              <input
                type="text"
                class="form-control state-m"
                placeholder="Enter your state"
                name="state"
              />
            </div>
            <div class="col-12">
              <label for="state" class="form-label">Address</label>
              <input
                type="text"
                class="form-control"
                placeholder="Enter your Address"
                name="address"
              />
            </div>
            <button type="button" id="submit-sm" class="btn btn-primary">
              Create account
            </button>
          </form>
        </div>
      </div>
      <div id="mobFoot-placeholder"></div>
      <script>
        $(document).ready(function () {
          $("#mobFoot-placeholder").load("./Template/mobileFooter.html");
        });
      </script>
    </div>
    <!---Mobile screen end-->
    <!--script to fetch state and city Desktop-->
    <script>
      let pin = document.querySelector(".pin");
      let state = document.querySelector(".state");
      let city = document.querySelector(".city");
      const Pin = async () => {
        let userPin = pin.value;
        if (userPin.length == 6) {
          const response = await fetch(
            `https://api.postalpincode.in/pincode/${userPin}`
          );
          const data = await response.json();
          const PinData = data.map((items) => {
            const { PostOffice } = items;
            return PostOffice;
          });
          PinData[0].map((items) => {
            const { State, District } = items;
            state.value = State;
            city.value = District;
          });
        }
      };
    </script>
    <!--script to fetch state and city Desktop end-->
    <!--script to fetch state and city Mobile-->
    <script>
      let pinM = document.querySelector(".pin-m");
      let stateM = document.querySelector(".state-m");
      let cityM = document.querySelector(".city-m");
      const PinMobile = async () => {
        let userPin = pinM.value;
        if (userPin.length == 6) {
          const response = await fetch(
            `https://api.postalpincode.in/pincode/${userPin}`
          );
          const data = await response.json();
          const PinData = data.map((items) => {
            const { PostOffice } = items;
            return PostOffice;
          });
          PinData[0].map((items) => {
            const { State, District } = items;
            stateM.value = State;
            cityM.value = District;
          });
        }
      };
    </script>
    <!--script to fetch state and city Mobile end-->

    <script type="module">
      import config from "./conf/index.js";

      async function postData(url = "", data = {}) {
        try {
          const response = await fetch(url, {
            method: "POST",
            mode: "cors",
            cache: "no-cache",
            credentials: "same-origin",
            headers: {
              "Content-Type": "application/json",
            },
            redirect: "follow",
            referrerPolicy: "no-referrer",
            body: JSON.stringify(data),
          });
          return response.json();
        } catch (err) {
          console.error(err);
        }
      }

      document
        .getElementById("submit")
        .addEventListener("click", async function (event) {
          const formData = Array.from(
            document.querySelectorAll(".register-lg-form input")
          ).reduce((acc, input) => ({ ...acc, [input.id]: input.value }), {});

          const res = await postData(
            config.backendEndpoint + "/customer_signup",
            formData
          );

          if (res.status === "success") {
            console.log(res.msg);
            Toastify({
              text: "User Added",
              duration: 3000,
              newWindow: true,
              close: true,
              gravity: "top", // `top` or `bottom`
              position: "right", // `left`, `center` or `right`
              stopOnFocus: true, // Prevents dismissing of toast on hover
              style: {
                background: "#32cd32",
              },
            }).showToast();
            // window.location ;
            setTimeout(() => (window.location = "./sign.html"), 3000);
          } else {
            Toastify({
              text: res.msg,
              duration: 3000,
              newWindow: true,
              close: true,
              gravity: "top", // `top` or `bottom`
              position: "right", // `left`, `center` or `right`
              stopOnFocus: true, // Prevents dismissing of toast on hover
              style: {
                background: "red",
              },
            }).showToast();
          }
        });

      document
        .getElementById("submit-sm")
        .addEventListener("click", async function (event) {
          const formData = Array.from(
            document.querySelectorAll(".register-form-sm input")
          ).reduce((acc, input) => ({ ...acc, [input.name]: input.value }), {});

          const res = await postData(
            config.backendEndpoint + "/customer_signup",
            formData
          );

          if (res.status === "success") {
            Toastify({
              text: "User Added",
              duration: 3000,
              newWindow: true,
              close: true,
              gravity: "top", // `top` or `bottom`
              position: "right", // `left`, `center` or `right`
              stopOnFocus: true, // Prevents dismissing of toast on hover
              style: {
                background: "#32cd32",
              },
            }).showToast();
            // window.location ;
            setTimeout(() => (window.location = "./sign.html"), 3000);
          } else {
            Toastify({
              text: res.msg,
              duration: 3000,
              newWindow: true,
              close: true,
              gravity: "top", // `top` or `bottom`
              position: "right", // `left`, `center` or `right`
              stopOnFocus: true, // Prevents dismissing of toast on hover
              style: {
                background: "red",
              },
            }).showToast();
          }
        });
    </script>

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>
  </body>
</html>
